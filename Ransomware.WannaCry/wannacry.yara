rule Ransomware_Wannacry { 
    meta: 
        last_updated = "2021-12-30"
        author = "An00bRektn"
        description = "A simple yara rule to detect WannaCry"

    strings:
        $PE_magic_byte = "MZ"
        $x1 = "__TREEID__PLACEHOLDER__"
        $x2 = "__USERID__PLACEHOLDER__"
        $x3 = "wnry"

        // Catch hardcoded SMB syntax
        $s1 = /\\\\(\d{1,3}\.){3}\d{1,3}\\IPC\$/ nocase fullword wide
        $s2 = "\\\\%s\\IPC$" fullword ascii
        
        // Note that these two probably change between variations
        $s3 = "WANACRY!" fullword ascii
        $s4 = "WanaCrypt0r" fullword ascii
        $s5 = "http://www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com" ascii

    condition:
        $PE_magic_byte at 0 and
        ($x1 and $x2) and ($s1 or $s2) and ($s3 or $s4) or $x3 or $s5
}
